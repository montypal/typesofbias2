<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bias Investigator: Mastery Quiz</title>
    <style>
        :root {
            --primary: #2c3e50; --secondary: #3498db; --success: #27ae60;
            --danger: #e74c3c; --light: #f4f7f6; --gold: #f1c40f; --accent: #8e44ad;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--light); display: flex; justify-content: center; padding: 20px; margin: 0; }
        .quiz-container { background: white; width: 100%; max-width: 750px; padding: 40px; border-radius: 15px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); border-top: 10px solid var(--accent); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .progress-text { color: #7f8c8d; font-weight: bold; }
        
        .question-box { margin-bottom: 30px; }
        .question-text { font-size: 1.4rem; color: var(--primary); font-weight: 600; line-height: 1.4; margin-bottom: 20px; }
        
        .options-grid { display: grid; gap: 12px; }
        .option-btn { 
            padding: 18px; border: 2px solid #e0e0e0; border-radius: 10px; background: white; 
            cursor: pointer; text-align: left; font-size: 1.1rem; transition: all 0.2s; color: #444;
        }
        .option-btn:hover:not([disabled]) { border-color: var(--secondary); background: #f0f7ff; transform: translateY(-2px); }
        .option-btn:disabled { cursor: default; }
        
        /* State Colors */
        .correct { background: var(--success) !important; color: white !important; border-color: var(--success) !important; }
        .wrong { background: var(--danger) !important; color: white !important; border-color: var(--danger) !important; }
        
        /* Feedback Area */
        .feedback-section { margin-top: 30px; padding: 25px; border-radius: 12px; display: none; background: #fff; border: 1px solid #ddd; animation: fadeIn 0.5s; }
        .example-box { background: #fffbe6; border-left: 5px solid var(--gold); padding: 15px; margin: 15px 0; font-style: italic; color: #856404; }
        
        /* Text Entry */
        .text-challenge { margin-top: 30px; border-top: 2px solid #f0f0f0; padding-top: 25px; }
        textarea { width: 100%; height: 120px; padding: 15px; border-radius: 10px; border: 2px solid #ddd; font-family: inherit; font-size: 1rem; box-sizing: border-box; resize: vertical; margin-bottom: 15px; }
        textarea:focus { border-color: var(--accent); outline: none; }
        
        .grade-btn { background: var(--primary); color: white; width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
        .grade-btn:hover { background: #1a252f; }
        
        #grading-result { margin-top: 20px; padding: 15px; border-radius: 8px; display: none; background: #f8f9fa; text-align: center; }
        .score-display { font-size: 2rem; font-weight: bold; color: var(--accent); margin-bottom: 10px; }
        
        #next-btn { background: var(--success); color: white; width: 100%; padding: 18px; border: none; border-radius: 10px; font-weight: bold; margin-top: 20px; cursor: pointer; display: none; font-size: 1.2rem; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="quiz-container" id="main-box">
    <div class="header">
        <div class="progress-text">Case File <span id="current-num">1</span> of <span id="total-num">5</span></div>
        <div style="font-size: 0.8rem; color: #999;">Epidemiology Training Module</div>
    </div>

    <div class="question-box">
        <div class="question-text" id="question-display">Loading next mystery...</div>
        <div class="options-grid" id="options-display"></div>
    </div>

    <div id="feedback-area" class="feedback-section">
        <div id="mcq-message"></div>
        <div class="example-box">
            <strong>Standard Example:</strong><br>
            <span id="bias-example-text"></span>
        </div>
        
        <div class="text-challenge">
            <p><strong>Step 2: Applied Knowledge</strong><br>
            Describe a <u>new</u> scenario that illustrates this bias:</p>
            <textarea id="user-input" placeholder="Think like an investigator... what else could cause this bias?"></textarea>
            <div id="error-msg" style="color: var(--danger); font-size: 0.9rem; margin-bottom: 10px; display: none;">Please write at least 20 characters for a valid grade.</div>
            <button class="grade-btn" id="submit-grade-btn" onclick="processGrading()">Analyze & Grade My Answer</button>
            
            <div id="grading-result">
                <div class="score-display" id="score-text">0/100</div>
                <p id="grading-feedback-text" style="line-height: 1.5; color: #555;"></p>
            </div>
        </div>
        <button id="next-btn" onclick="nextQuestion()">Proceed to Next Case &rarr;</button>
    </div>
</div>

<script>
    const biasDatabase = [
        {
            type: "Recall Bias",
            scenario: "In an investigation into 'Emoji Fever', cases (the sick) were able to list every app they used in the last month, while controls (the healthy) only remembered their top 3 apps. What is this?",
            options: ["Selection Bias", "Recall Bias", "Confounding", "Observation Bias"],
            correctIndex: 1,
            officialExample: "Mothers of children with birth defects often remember minor infections they had during pregnancy much more vividly than mothers of healthy children.",
            keywords: ["remember", "past", "memory", "forget", "accurate", "history", "recall"]
        },
        {
            type: "Selection Bias",
            scenario: "Dr. Alyssa's study on 'Snapchat Syndrome' [cite: 15] only recruited teenagers from an elite private tech camp. The results showed 90% prevalence, but didn't represent the whole city. What is this?",
            options: ["Social Desirability", "Information Bias", "Selection Bias", "Confounding"],
            correctIndex: 2,
            officialExample: "The 'Healthy Worker Effect': People who are healthy enough to work a 40-hour week are naturally healthier than the general population, which includes those too sick to work.",
            keywords: ["recruit", "sample", "enroll", "group", "population", "represent", "volunteer"]
        },
        {
            type: "Confounding",
            scenario: "Dr. Kangin finds that people who drink more coffee have higher rates of lung cancer. However, coffee drinkers are also more likely to smoke cigarettes. What is smoking in this study?",
            options: ["Recall Bias", "Selection Bias", "Confounding", "Observer Bias"],
            correctIndex: 2,
            officialExample: "Studying the relationship between carrying matches and lung cancerâ€”the real cause is smoking, which is linked to both carrying matches and cancer.",
            keywords: ["third", "factor", "link", "association", "distort", "relationship", "cause"]
        },
        {
            type: "Observer Bias",
            scenario: "A researcher knows which patients received the real 'Viral Vibes' vaccine. They subconsciously record milder symptoms for the vaccinated group than the unvaccinated group. What is this?",
            options: ["Selection Bias", "Observer Bias", "Recall Bias", "Non-response Bias"],
            correctIndex: 1,
            officialExample: "A doctor measuring blood pressure who knows the patient is on a new medication might subconsciously round the numbers down to show the drug is 'working'.",
            keywords: ["researcher", "doctor", "scientist", "knowledge", "interpret", "expect", "influence"]
        },
        {
            type: "Social Desirability Bias",
            scenario: "Participants in a study about 'Meme Madness' [cite: 51] were asked how many hours they spend looking at memes. Most said '1 hour' even though their screen time said '6 hours' because they felt embarrassed. What is this?",
            options: ["Social Desirability Bias", "Recall Bias", "Selection Bias", "Measurement Bias"],
            correctIndex: 0,
            officialExample: "In surveys about voting, more people report that they voted than actually did, because voting is seen as a positive social behavior.",
            keywords: ["embarrassed", "report", "lie", "true", "social", "shame", "answer", "stigma"]
        }
    ];

    let currentStep = 0;

    function startQuiz() {
        document.getElementById('total-num').innerText = biasDatabase.length;
        loadQuestion();
    }

    function loadQuestion() {
        const data = biasDatabase[currentStep];
        document.getElementById('current-num').innerText = currentStep + 1;
        document.getElementById('question-display').innerText = data.scenario;
        
        const optionsDiv = document.getElementById('options-display');
        optionsDiv.innerHTML = '';
        
        // Reset the UI
        document.getElementById('feedback-area').style.display = 'none';
        document.getElementById('grading-result').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('user-input').value = '';
        document.getElementById('submit-grade-btn').disabled = false;
        document.getElementById('submit-grade-btn').style.opacity = '1';
        document.getElementById('error-msg').style.display = 'none';

        data.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkMCQ(idx, btn);
            optionsDiv.appendChild(btn);
        });
    }

    function checkMCQ(userChoice, btn) {
        const data = biasDatabase[currentStep];
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        const msg = document.getElementById('mcq-message');
        if(userChoice === data.correctIndex) {
            btn.classList.add('correct');
            msg.innerHTML = `<h3 style="color:var(--success); margin:0;">Target Identified! Correct.</h3>`;
        } else {
            btn.classList.add('wrong');
            allBtns[data.correctIndex].classList.add('correct');
            msg.innerHTML = `<h3 style="color:var(--danger); margin:0;">Missed the Mark.</h3>`;
        }

        document.getElementById('bias-example-text').innerText = data.officialExample;
        document.getElementById('feedback-area').style.display = 'block';
    }

    function processGrading() {
        const text = document.getElementById('user-input').value.toLowerCase();
        const error = document.getElementById('error-msg');
        const data = biasDatabase[currentStep];

        if(text.length < 20) {
            error.style.display = 'block';
            return;
        }
        error.style.display = 'none';

        // Simulated Analysis
        let score = 10; // Participation points
        data.keywords.forEach(word => {
            if(text.includes(word)) score += 15;
        });
        
        if(text.length > 60) score += 10;
        if(text.length > 100) score += 10;
        
        const finalScore = Math.min(100, score);
        
        const resBox = document.getElementById('grading-result');
        const scoreTxt = document.getElementById('score-text');
        const feedTxt = document.getElementById('grading-feedback-text');
        
        resBox.style.display = 'block';
        scoreTxt.innerText = `${finalScore}/100`;
        
        if(finalScore >= 80) {
            feedTxt.innerText = "Exceptional analysis! You used specific terminology and clearly described the mechanism of " + data.type + ".";
        } else if (finalScore >= 50) {
            feedTxt.innerText = "Solid example. To improve, try using more precise terms like '" + data.keywords[0] + "' to describe the error.";
        } else {
            feedTxt.innerText = "Your example is a bit broad. Make sure your scenario specifically shows how the results are distorted by " + data.type + ".";
        }

        document.getElementById('submit-grade-btn').disabled = true;
        document.getElementById('submit-grade-btn').style.opacity = '0.5';
        document.getElementById('next-btn').style.display = 'block';
    }

    function nextQuestion() {
        currentStep++;
        if(currentStep < biasDatabase.length) {
            loadQuestion();
        } else {
            document.getElementById('main-box').innerHTML = `
                <div style="text-align:center; padding: 40px;">
                    <h2 style="color:var(--accent);">Investigation Complete</h2>
                    <p style="font-size: 1.2rem;">You have successfully identified and described 5 critical epidemiological biases.</p>
                    <button class="option-btn" style="width:100%; text-align:center; background: var(--primary); color:white;" onclick="location.reload()">Re-run Simulation</button>
                </div>
            `;
        }
    }

    window.onload = startQuiz;
</script>

</body>
</html>
